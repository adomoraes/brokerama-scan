// Este ficheiro define os modelos do nosso banco de dados.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL") // Lê a URL do nosso ficheiro .env
}

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  name         String?
  passwordHash String
  createdAt    DateTime @default(now())

  // RELAÇÃO: Um usuário pode ter VÁRIOS scanners
  scanners Scanner[]
}

model Scanner {
  id            Int      @id @default(autoincrement())
  assetTicker   String
  conditionType String
  value         Float
  isActive      Boolean  @default(true) // NOVO: Para controlar se o scanner está ativo
  createdAt     DateTime @default(now())
  owner         User     @relation(fields: [ownerId], references: [id])
  ownerId       Int

  // RELAÇÃO: Um scanner pode ter vários alertas (histórico)
  alerts Alert[]
}

model Alert {
  id          Int      @id @default(autoincrement())
  message     String // A mensagem do alerta (ex: "PETR4 ultrapassou R$ 40.50")
  triggeredAt DateTime @default(now())

  // RELAÇÃO: Este alerta foi gerado por UM scanner
  scanner   Scanner @relation(fields: [scannerId], references: [id])
  scannerId Int
}
